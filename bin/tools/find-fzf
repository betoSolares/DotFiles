#!/bin/sh
# Find with fzf

USAGE() { printf "%s" "\
USAGE: find-fzf [options]
    Directory
        -d, --directory [path] The directory to search. By default is the current directory

    File name
        -n, --name [name] The name of the file to search

    Type
        -t, --type [filetype] The type of the file to search
                b      block (buffered) special
	        c      character (unbuffered) special
	        d      directory
	        p      named pipe (FIFO)
	        f      regular file
	        l      symbolic  link
	        s      socket
	        D      door (Solaris)

"
}

dir="."
filetype="f"
name=

# Read arguments
while [ "$1" != "" ]; do
	case $1 in
		-h | --help ) USAGE && exit ;;
		-d | --directory )
			shift
			dir="$1" ;;
		-n | --name )
			shift
			name="$1" ;;
		-t | --type )
			shift
			filetype="$1" ;;
		* ) USAGE && exit 1;
	esac
	shift
done

# Check errors
if [[ ! -d "$dir" ]]; then
	printf "The directory $dir dosn't exist.\n" && exit 1;
fi 

if [[ ! "$filetype" =~ (b|c|d|p|f|l|s|d) ]]; then 
	printf "The file type must be b, c, d, p, f, l, s or d.\n" && exit 1;
fi

# Run program
if [[ -z "$name" ]]; then
	find "$dir" -type "$filetype" 2>/dev/null | fzf 
else
	find "$dir" -type "$filetype" 2>/dev/null | fzf -q "$name"
fi
